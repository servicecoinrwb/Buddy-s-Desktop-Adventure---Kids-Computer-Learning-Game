<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buddy's Desktop Adventure</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Comic Sans MS', cursive;
      background: linear-gradient(45deg, #87CEEB, #98FB98);
      height: 100vh; overflow: hidden; cursor: default;
    }
    .desktop {
      width: 100%; height: 100vh; position: relative;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.3)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.4)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.5)"/></svg>');
    }
    .taskbar {
      position: absolute; bottom: 0; left: 0; right: 0; height: 60px;
      background: linear-gradient(to bottom, #4CAF50, #45a049);
      display: flex; align-items: center; padding: 0 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
    }
    .start-button {
      background: linear-gradient(to bottom, #FF6B6B, #FF5252); border: none; border-radius: 15px;
      padding: 10px 20px; color: white; font-size: 18px; font-weight: bold; cursor: pointer; margin-right: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.1s;
    }
    .start-button:hover { transform: scale(1.05); }
    .buddy-status {
      background: rgba(255,255,255,0.9); border-radius: 10px; padding: 5px 15px;
      margin-left: auto; display: flex; align-items: center; gap: 10px;
    }
    .happiness-bar { width: 100px; height: 20px; background: #ddd; border-radius: 10px; overflow: hidden; }
    .happiness-fill { height: 100%; background: linear-gradient(to right, #FF6B6B, #4CAF50); border-radius: 10px; transition: width 0.5s; width: 70%; }

    .desktop-icon {
      position: absolute; width: 80px; height: 80px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center;
      border-radius: 15px; transition: transform 0.2s; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); user-select: none;
    }
    .desktop-icon:hover { transform: scale(1.1); background: rgba(255,255,255,0.2); }
    .icon-image { width: 48px; height: 48px; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; justify-content: center; font-size: 32px; }
    .icon-label { color: white; font-size: 12px; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); text-align: center; }

    .buddy-pet {
      position: absolute; bottom: 100px; right: 100px; width: 120px; height: 120px; background: #FFE4B5; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; font-size: 60px; cursor: pointer; transition: transform 0.3s;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2); animation: float 3s ease-in-out infinite;
    }
    .buddy-pet:hover { transform: scale(1.1); }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }

    .window {
      position: absolute; background: white; border-radius: 10px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      min-width: 300px; min-height: 200px; z-index: 1000; display: none;
    }
    .window-header {
      background: linear-gradient(to right, #6C5CE7, #A29BFE); color: white; padding: 10px 15px; border-radius: 10px 10px 0 0;
      display: flex; justify-content: space-between; align-items: center; cursor: move;
    }
    .window-title { font-weight: bold; font-size: 16px; }
    .close-btn { background: #FF6B6B; border: none; color: white; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-weight: bold; transition: transform 0.1s; }
    .close-btn:hover { transform: scale(1.1); }
    .window-content { padding: 20px; }

    .app-button {
      background: linear-gradient(to bottom, #4ECDC4, #44A08D); border: none; color: white; padding: 12px 24px; border-radius: 8px;
      font-size: 16px; cursor: pointer; margin: 5px; transition: transform 0.1s;
    }
    .app-button:hover { transform: scale(1.05); }

    .feeding-game { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; }
    .food-item {
      width: 80px; height: 80px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 40px;
      transition: transform 0.2s; border: 3px solid transparent;
    }
    .food-item:hover { transform: scale(1.1); border-color: #4CAF50; }

    .typing-area {
      width: 100%; padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 8px; margin: 10px 0; font-family: 'Comic Sans MS', cursive;
    }

    .achievement {
      position: fixed; top: 20px; right: 20px; background: linear-gradient(to right, #FFD700, #FFA500); color: white;
      padding: 10px 20px; border-radius: 10px; font-weight: bold; transform: translateX(300px); transition: transform 0.5s; z-index: 2000;
    }
    .achievement.show { transform: translateX(0); }

    .progress-bar { width: 100%; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden; margin: 10px 0; }
    .progress-fill { height: 100%; background: #4CAF50; border-radius: 4px; transition: width 0.5s; width: 0%; }

    .folder {
      text-align: center; padding: 20px; border: 3px dashed #ddd; border-radius: 15px; min-height: 100px; display: flex; flex-direction: column;
      align-items: center; justify-content: center; transition: all 0.3s; background: rgba(255,255,255,0.5);
    }
    .folder.drag-over { border-color: #4CAF50; background: rgba(76, 175, 80, 0.1); transform: scale(1.05); }
    .file-items { display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 8px; min-height: 80px; }
    .file-item {
      background: linear-gradient(to bottom, #E8F5E8, #C8E6C9); padding: 10px 15px; border-radius: 8px; cursor: move; font-size: 14px; font-weight: bold;
      border: 2px solid transparent; transition: all 0.2s; user-select: none;
    }
    .file-item:hover { transform: scale(1.05); border-color: #4CAF50; }
    .file-item.dragging { opacity: 0.5; transform: rotate(5deg); }

    .piano { display: flex; margin: 20px 0; height: 120px; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    .piano-key { display: flex; align-items: flex-end; justify-content: center; cursor: pointer; transition: all 0.1s; user-select: none; font-weight: bold; padding-bottom: 10px; }
    .piano-key.white { background: white; border: 1px solid #ddd; flex: 1; height: 100%; color: #333; }
    .piano-key.black { background: #333; color: white; width: 30px; height: 60%; margin: 0 -15px; z-index: 1; border-radius: 0 0 4px 4px; }
    .piano-key:hover { background: #f0f0f0; }
    .piano-key.black:hover { background: #555; }
    .piano-key.active { background: #4CAF50 !important; transform: translateY(2px); }

    .calculator-display {
      background: #000; color: #00FF00; font-size: 24px; font-weight: bold; padding: 15px; text-align: right; border-radius: 8px;
      margin-bottom: 15px; min-height: 50px; display: flex; align-items: center; justify-content: flex-end; font-family: 'Courier New', monospace;
    }
    .calculator-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
    .calc-btn { background: linear-gradient(to bottom, #f0f0f0, #e0e0e0); border: none; padding: 15px; font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: all 0.1s; }
    .calc-btn:hover { background: linear-gradient(to bottom, #e0e0e0, #d0d0d0); transform: scale(1.05); }
    .calc-btn:active { transform: scale(0.95); }
    .calc-btn.clear { background: linear-gradient(to bottom, #FF6B6B, #FF5252); color: white; }

    .photo-container { position: relative; height: 250px; overflow: hidden; border-radius: 8px; background: #f0f0f0; }
    .photo-display { width: 100%; height: 100%; position: relative; transform-origin: center; transition: transform 0.3s; }
    .photo { position: absolute; width: 100%; height: 100%; border-radius: 8px; opacity: 0; transform: translateX(100%); transition: all 0.5s; }
    .photo.active { opacity: 1; transform: translateX(0); }
    .photo.prev { transform: translateX(-100%); }

    .achievement-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; max-height: 300px; overflow-y: auto; }
    .achievement-item {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 12px; text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); opacity: 0.3; transition: all 0.3s;
    }
    .achievement-item.earned { opacity: 1; transform: scale(1.02); }
    .achievement-item .achievement-icon { font-size: 32px; margin-bottom: 8px; }
    .achievement-item .achievement-name { font-weight: bold; margin-bottom: 5px; }
    .achievement-item .achievement-description { font-size: 12px; opacity: 0.9; }

    .coloring-pages { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 15px 0; }
    .coloring-page { text-align: center; padding: 15px; border: 2px solid #ddd; border-radius: 12px; background: #f9f9f9; cursor: pointer; transition: transform 0.2s; }
    .coloring-page:hover { transform: scale(1.05); border-color: #4CAF50; }
    .coloring-page svg { width: 100%; height: auto; max-width: 150px; }
    .colorable { cursor: pointer; transition: fill 0.3s; }
    .colorable:hover { opacity: 0.8; }
    .color-btn { width: 40px; height: 40px; border: 3px solid #ddd; border-radius: 50%; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    .color-btn:hover { transform: scale(1.1); border-color: #333; }
    .color-btn.selected { border-color: #333; border-width: 4px; transform: scale(1.15); }

    .jump-game-container {
      position: relative; width: 100%; height: 200px;
      background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 70%, #8FBC8F 100%);
      border-radius: 8px; margin: 15px 0; overflow: hidden; cursor: pointer;
    }
    .game-ground { position: absolute; bottom: 0; left: 0; right: 0; height: 30px; background: #8FBC8F; border-top: 3px solid #228B22; }
    .jump-character { position: absolute; bottom: 30px; left: 50px; font-size: 32px; z-index: 10; }
    .jump-obstacle { position: absolute; bottom: 25px; font-size: 24px; animation: moveObstacle 4s linear infinite; }
    .jump-star { position: absolute; bottom: 80px; font-size: 20px; animation: moveStar 5s linear infinite; z-index: 5; }
    @keyframes moveObstacle { from { right: -50px; } to { right: 100%; } }
    @keyframes moveStar { from { right: -50px; } to { right: 100%; } }
    .jump-instructions {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;
      background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; font-weight: bold; z-index: 15;
    }
    .jump-instructions.hidden { display: none; }
    .game-over {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;
      background: rgba(255,255,255,0.95); padding: 20px; border-radius: 10px; font-weight: bold; z-index: 20;
    }
  </style>
</head>
<body>
  <div class="desktop" id="desktop">
    <!-- Desktop Icons -->
    <div class="desktop-icon" style="top: 50px; left: 50px;" onclick="openApp('food')">
      <div class="icon-image" style="background: #FF6B6B;">üçé</div>
      <div class="icon-label">Feed Buddy</div>
    </div>

    <div class="desktop-icon" style="top: 50px; left: 150px;" onclick="openApp('jumpgame')">
      <div class="icon-image" style="background: #4ECDC4;">üéÆ</div>
      <div class="icon-label">Jump Game</div>
    </div>

    <div class="desktop-icon" style="top: 50px; left: 250px;" onclick="openApp('coloring')">
      <div class="icon-image" style="background: #FF69B4;">üñçÔ∏è</div>
      <div class="icon-label">Coloring Book</div>
    </div>

    <div class="desktop-icon" style="top: 50px; left: 350px;" onclick="openApp('art')">
      <div class="icon-image" style="background: #A29BFE;">üé®</div>
      <div class="icon-label">Art Studio</div>
    </div>

    <div class="desktop-icon" style="top: 150px; left: 50px;" onclick="openApp('typing')">
      <div class="icon-image" style="background: #26D0CE;">‚å®Ô∏è</div>
      <div class="icon-label">Typing Fun</div>
    </div>

    <div class="desktop-icon" style="top: 150px; left: 150px;" onclick="openApp('organize')">
      <div class="icon-image" style="background: #FD79A8;">üìÅ</div>
      <div class="icon-label">Organize</div>
    </div>

    <div class="desktop-icon" style="top: 250px; left: 50px;" onclick="openApp('music')">
      <div class="icon-image" style="background: #FF9500;">üéµ</div>
      <div class="icon-label">Music Maker</div>
    </div>

    <div class="desktop-icon" style="top: 250px; left: 150px;" onclick="openApp('calculator')">
      <div class="icon-image" style="background: #007AFF;">üßÆ</div>
      <div class="icon-label">Calculator</div>
    </div>

    <div class="desktop-icon" style="top: 250px; left: 250px;" onclick="openApp('photos')">
      <div class="icon-image" style="background: #34C759;">üì∑</div>
      <div class="icon-label">Photo Viewer</div>
    </div>

    <div class="desktop-icon" style="top: 50px; left: 450px;" onclick="openApp('achievements')">
      <div class="icon-image" style="background: #FFD700;">üèÜ</div>
      <div class="icon-label">Achievements</div>
    </div>

    <!-- NEW Math Game Icon (replaces Puzzle) -->
    <div class="desktop-icon" style="top: 150px; left: 250px;" onclick="openApp('math')">
      <div class="icon-image" style="background: #F9A826;">üî¢</div>
      <div class="icon-label">Math Challenge</div>
    </div>

    <!-- Buddy Pet -->
    <div class="buddy-pet" onclick="petBuddy()">üêï</div>

    <!-- Taskbar -->
    <div class="taskbar">
      <button class="start-button" onclick="showStartMenu()">üè† Start</button>
      <div class="buddy-status">
        <span>Buddy's Happiness:</span>
        <div class="happiness-bar">
          <div class="happiness-fill" id="happinessFill"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Food App Window -->
  <div class="window" id="foodWindow" style="top: 100px; left: 200px;">
    <div class="window-header">
      <div class="window-title">üçé Feed Buddy</div>
      <button class="close-btn" onclick="closeWindow('foodWindow')">&times;</button>
    </div>
    <div class="window-content">
      <p>Click on healthy foods to feed Buddy!</p>
      <div class="feeding-game">
        <div class="food-item" style="background: #FF6B6B;" onclick="feedBuddy('apple')">üçé</div>
        <div class="food-item" style="background: #4CAF50;" onclick="feedBuddy('broccoli')">ü•¶</div>
        <div class="food-item" style="background: #FF9800;" onclick="feedBuddy('carrot')">ü•ï</div>
        <div class="food-item" style="background: #9C27B0;" onclick="feedBuddy('grapes')">üçá</div>
        <div class="food-item" style="background: #FFEB3B;" onclick="feedBuddy('banana')">üçå</div>
        <div class="food-item" style="background: #795548;" onclick="feedBuddy('bread')">üçû</div>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="feedProgress"></div></div>
      <p><small>Progress: <span id="feedCount">0</span>/5 foods given</small></p>
    </div>
  </div>

  <!-- Typing App Window -->
  <div class="window" id="typingWindow" style="top: 120px; left: 300px;">
    <div class="window-header">
      <div class="window-title">‚å®Ô∏è Typing Fun</div>
      <button class="close-btn" onclick="closeWindow('typingWindow')">&times;</button>
    </div>
    <div class="window-content">
      <p>Help Buddy by typing his name!</p>
      <input type="text" class="typing-area" placeholder="Type 'BUDDY' here..." onkeyup="checkTyping(this.value)" id="typingInput">
      <div class="progress-bar"><div class="progress-fill" id="typingProgress"></div></div>
      <p><small>Great job! Keep typing to make Buddy happy!</small></p>
    </div>
  </div>

  <!-- Art Studio Window -->
  <div class="window" id="artWindow" style="top: 80px; left: 400px; width: 450px;">
    <div class="window-header">
      <div class="window-title">üé® Art Studio</div>
      <button class="close-btn" onclick="closeWindow('artWindow')">&times;</button>
    </div>
    <div class="window-content">
      <p>Draw a picture for Buddy!</p>
      <div style="display: flex; gap: 10px; margin: 10px 0;">
        <button class="app-button" onclick="setDrawColor('red')" style="background: #FF6B6B; padding: 8px 16px;">üî¥</button>
        <button class="app-button" onclick="setDrawColor('blue')" style="background: #4285F4; padding: 8px 16px;">üîµ</button>
        <button class="app-button" onclick="setDrawColor('green')" style="background: #4CAF50; padding: 8px 16px;">üü¢</button>
        <button class="app-button" onclick="setDrawColor('yellow')" style="background: #FFEB3B; color: black; padding: 8px 16px;">üü°</button>
        <button class="app-button" onclick="clearCanvas()" style="background: #757575; padding: 8px 16px;">üßπ Clear</button>
      </div>
      <canvas id="drawingCanvas" width="400" height="250" style="border: 3px solid #ddd; border-radius: 8px; cursor: crosshair; background: white;"></canvas>
      <div class="progress-bar"><div class="progress-fill" id="artProgress"></div></div>
      <p><small>Strokes: <span id="strokeCount">0</span>/10 - Keep drawing!</small></p>
    </div>
  </div>

  <!-- File Organization Window -->
  <div class="window" id="organizeWindow" style="top: 150px; left: 100px; width: 500px;">
    <div class="window-header">
      <div class="window-title">üìÅ Buddy's File Organizer</div>
      <button class="close-btn" onclick="closeWindow('organizeWindow')">&times;</button>
    </div>
    <div class="window-content">
      <p>Help Buddy organize his files! Drag each item to the right folder:</p>
      <div style="display: flex; justify-content: space-around; margin: 20px 0;">
        <div class="folder" data-type="photos" ondrop="dropFile(event)" ondragover="allowDrop(event)">
          <div style="font-size: 48px;">üì∑</div>
          <div>Photos</div>
        </div>
        <div class="folder" data-type="music" ondrop="dropFile(event)" ondragover="allowDrop(event)">
          <div style="font-size: 48px;">üéµ</div>
          <div>Music</div>
        </div>
        <div class="folder" data-type="games" ondrop="dropFile(event)" ondragover="allowDrop(event)">
          <div style="font-size: 48px;">üéÆ</div>
          <div>Games</div>
        </div>
      </div>
      <div class="file-items" id="fileItems">
        <div class="file-item" draggable="true" data-type="photos" ondragstart="dragFile(event)">üì∏ vacation.jpg</div>
        <div class="file-item" draggable="true" data-type="music" ondragstart="dragFile(event)">üéº happy-song.mp3</div>
        <div class="file-item" draggable="true" data-type="games" ondragstart="dragFile(event)">üïπÔ∏è puzzle-game.exe</div>
        <div class="file-item" draggable="true" data-type="photos" ondragstart="dragFile(event)">üñºÔ∏è buddy-photo.png</div>
        <div class="file-item" draggable="true" data-type="music" ondragstart="dragFile(event)">üéπ piano-tune.wav</div>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="organizeProgress"></div></div>
      <p><small>Files organized: <span id="organizedCount">0</span>/5</small></p>
    </div>
  </div>

  <!-- Music Maker Window -->
  <div class="window" id="musicWindow" style="top: 100px; left: 150px; width: 550px;">
    <div class="window-header">
      <div class="window-title">üéµ Music Maker</div>
      <button class="close-btn" onclick="closeWindow('musicWindow')">&times;</button>
    </div>
    <div class="window-content">
      <p>Play music for Buddy! Click keys or press keyboard keys:</p>
      <div style="margin: 10px 0;">
        <button class="app-button" onclick="playPause()" id="playBtn">‚ñ∂Ô∏è Play</button>
        <button class="app-button" onclick="recordMode()" id="recordBtn">‚è∫Ô∏è Record</button>
        <button class="app-button" onclick="clearSong()">üóëÔ∏è Clear</button>
        <span style="margin-left: 15px; font-weight: bold;">Press SPACEBAR to play/pause!</span>
      </div>
      <div class="piano" id="piano">
        <div class="piano-key white" data-note="C" onclick="playNote('C')">C</div>
        <div class="piano-key black" data-note="C#" onclick="playNote('C#')">C#</div>
        <div class="piano-key white" data-note="D" onclick="playNote('D')">D</div>
        <div class="piano-key black" data-note="D#" onclick="playNote('D#')">D#</div>
        <div class="piano-key white" data-note="E" onclick="playNote('E')">E</div>
        <div class="piano-key white" data-note="F" onclick="playNote('F')">F</div>
        <div class="piano-key black" data-note="F#" onclick="playNote('F#')">F#</div>
        <div class="piano-key white" data-note="G" onclick="playNote('G')">G</div>
        <div class="piano-key black" data-note="G#" onclick="playNote('G#')">G#</div>
        <div class="piano-key white" data-note="A" onclick="playNote('A')">A</div>
        <div class="piano-key black" data-note="A#" onclick="playNote('A#')">A#</div>
        <div class="piano-key white" data-note="B" onclick="playNote('B')">B</div>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="musicProgress"></div></div>
      <p><small>Notes played: <span id="noteCount">0</span>/15</small></p>
    </div>
  </div>

  <!-- Calculator Window -->
  <div class="window" id="calculatorWindow" style="top: 120px; left: 200px; width: 300px;">
    <div class="window-header">
      <div class="window-title">üßÆ Buddy's Calculator</div>
      <button class="close-btn" onclick="closeWindow('calculatorWindow')">&times;</button>
    </div>
    <div class="window-content">
      <div class="calculator-display" id="calcDisplay">0</div>
      <div class="calculator-grid">
        <button class="calc-btn clear" onclick="clearCalc()" style="grid-column: span 2;">C</button>
        <button class="calc-btn" onclick="calcInput('/')" style="background: #FF9500; color: white;">√∑</button>
        <button class="calc-btn" onclick="calcInput('*')" style="background: #FF9500; color: white;">√ó</button>

        <button class="calc-btn" onclick="calcInput('7')">7</button>
        <button class="calc-btn" onclick="calcInput('8')">8</button>
        <button class="calc-btn" onclick="calcInput('9')">9</button>
        <button class="calc-btn" onclick="calcInput('-')" style="background: #FF9500; color: white;">-</button>

        <button class="calc-btn" onclick="calcInput('4')">4</button>
        <button class="calc-btn" onclick="calcInput('5')">5</button>
        <button class="calc-btn" onclick="calcInput('6')">6</button>
        <button class="calc-btn" onclick="calcInput('+')" style="background: #FF9500; color: white; grid-row: span 2;">+</button>

        <button class="calc-btn" onclick="calcInput('1')">1</button>
        <button class="calc-btn" onclick="calcInput('2')">2</button>
        <button class="calc-btn" onclick="calcInput('3')">3</button>
        <button class="calc-btn" onclick="calculateResult()" style="background: #4CAF50; color: white; grid-row: span 2;">=</button>

        <button class="calc-btn zero" onclick="calcInput('0')" style="grid-column: span 2;">0</button>
        <button class="calc-btn" onclick="calcInput('.')">.</button>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="calcProgress"></div></div>
      <p><small>Calculations done: <span id="calcCount">0</span>/5</small></p>
    </div>
  </div>

  <!-- Photo Viewer Window -->
  <div class="window" id="photosWindow" style="top: 80px; left: 350px; width: 450px;">
    <div class="window-header">
      <div class="window-title">üì∑ Buddy's Photo Album</div>
      <button class="close-btn" onclick="closeWindow('photosWindow')">&times;</button>
    </div>
    <div class="window-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <button class="app-button" onclick="previousPhoto()">‚¨ÖÔ∏è Previous</button>
        <span id="photoCounter">1 / 4</span>
        <button class="app-button" onclick="nextPhoto()">Next ‚û°Ô∏è</button>
      </div>
      <div class="photo-container">
        <div class="photo-display" id="photoDisplay">
          <div class="photo active" style="background: linear-gradient(45deg, #FF6B6B, #4ECDC4); display: flex; align-items: center; justify-content: center; font-size: 80px;">üêï</div>
          <div class="photo" style="background: linear-gradient(45deg, #4CAF50, #8BC34A); display: flex; align-items: center; justify-content: center; font-size: 80px;">üå≥</div>
          <div class="photo" style="background: linear-gradient(45deg, #2196F3, #03DAC6); display: flex; align-items: center; justify-content: center; font-size: 80px;">üèñÔ∏è</div>
          <div class="photo" style="background: linear-gradient(45deg, #FF9800, #FFEB3B); display: flex; align-items: center; justify-content: center; font-size: 80px;">üéÇ</div>
        </div>
      </div>
      <div style="text-align: center; margin: 15px 0;">
        <button class="app-button" onclick="zoomOut()">üîç‚ûñ Zoom Out</button>
        <button class="app-button" onclick="zoomIn()">üîç‚ûï Zoom In</button>
        <button class="app-button" onclick="resetZoom()">‚Ü©Ô∏è Reset</button>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="photoProgress"></div></div>
      <p><small>Photos viewed: <span id="photoViewCount">1</span>/4</small></p>
    </div>
  </div>

  <!-- Achievement Gallery Window -->
  <div class="window" id="achievementsWindow" style="top: 50px; left: 250px; width: 500px;">
    <div class="window-header">
      <div class="window-title">üèÜ Achievement Gallery</div>
      <button class="close-btn" onclick="closeWindow('achievementsWindow')">&times;</button>
    </div>
    <div class="window-content">
      <p>Look at all the amazing things you've learned!</p>
      <div class="achievement-grid" id="achievementGrid"></div>
      <div style="text-align: center; margin-top: 20px;">
        <div style="font-size: 18px; font-weight: bold;">Total Achievements: <span id="totalAchievements">0</span></div>
        <div style="font-size: 14px; color: #666; margin-top: 5px;">Keep playing to earn more! üåü</div>
      </div>
    </div>
  </div>

  <!-- Coloring Book Window -->
  <div class="window" id="coloringWindow" style="top: 150px; left: 450px; width: 480px;">
    <div class="window-header">
      <div class="window-title">üñçÔ∏è Coloring Book</div>
      <button class="close-btn" onclick="closeWindow('coloringWindow')">&times;</button>
    </div>
    <div class="window-content">
      <p>Click a color, then click a part of the picture to color it in!</p>
      <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: center;">
        <div class="color-btn" style="background: #FF6B6B;" onclick="setColoringColor('#FF6B6B', this)"></div>
        <div class="color-btn" style="background: #4ECDC4;" onclick="setColoringColor('#4ECDC4', this)"></div>
        <div class="color-btn" style="background: #45B7D1;" onclick="setColoringColor('#45B7D1', this)"></div>
        <div class="color-btn" style="background: #FED766;" onclick="setColoringColor('#FED766', this)"></div>
        <div class="color-btn" style="background: #9B5DE5;" onclick="setColoringColor('#9B5DE5', this)"></div>
        <div class="color-btn" style="background: #F15BB5;" onclick="setColoringColor('#F15BB5', this)"></div>
      </div>
      <div class="coloring-pages">
        <div class="coloring-page">
          <svg viewBox="0 0 100 100">
            <polygon class="colorable" points="15,50 85,50 50,20" stroke="black" stroke-width="2" fill="white"/>
            <rect class="colorable" x="20" y="50" width="60" height="40" stroke="black" stroke-width="2" fill="white"/>
            <rect class="colorable" x="40" y="70" width="20" height="20" stroke="black" stroke-width="2" fill="white"/>
          </svg>
        </div>
        <div class="coloring-page">
          <svg viewBox="0 0 100 100">
            <circle class="colorable" cx="50" cy="50" r="20" stroke="black" stroke-width="2" fill="white"/>
            <line class="colorable" x1="50" y1="20" x2="50" y2="0" stroke="black" stroke-width="2" stroke-linecap="round"/>
            <line class="colorable" x1="50" y1="80" x2="50" y2="100" stroke="black" stroke-width="2" stroke-linecap="round"/>
            <line class="colorable" x1="20" y1="50" x2="0" y2="50" stroke="black" stroke-width="2" stroke-linecap="round"/>
            <line class="colorable" x1="80" y1="50" x2="100" y2="50" stroke="black" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="coloringProgress"></div></div>
      <p><small>Parts Colored: <span id="coloredCount">0</span>/20</small></p>
    </div>
  </div>

  <!-- Jump Game Window -->
  <div class="window" id="jumpgameWindow" style="top: 100px; left: 500px; width: 450px;">
    <div class="window-header">
      <div class="window-title">üéÆ Princess Jump Adventure</div>
      <button class="close-btn" onclick="closeWindow('jumpgameWindow')">&times;</button>
    </div>
    <div class="window-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <button class="app-button" onclick="switchCharacter('princess')" id="princessBtn">üë∏ Princess</button>
        <button class="app-button" onclick="switchCharacter('astronaut')" id="astronautBtn">üë®‚ÄçüöÄ Astronaut</button>
        <button class="app-button" onclick="startJumpGame()" id="startBtn">‚ñ∂Ô∏è Start Game</button>
      </div>
      <div class="jump-game-container" id="jumpGameContainer">
        <div class="jump-character" id="jumpCharacter">üë∏</div>
        <div class="game-ground"></div>
        <div class="jump-instructions" id="jumpInstructions"><p>Click or Hold to Jump!</p></div>
      </div>
      <div style="display: flex; justify-content: space-between; font-weight: bold; margin-top: 10px;">
        <span>Score: <span id="jumpScore">0</span></span>
        <span>Stars: <span id="starCount">0</span>/15</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="jumpProgress"></div></div>
    </div>
  </div>

  <!-- NEW Math Game Window -->
  <div class="window" id="mathWindow" style="top: 80px; left: 180px; width: 520px;">
    <div class="window-header">
      <div class="window-title">üî¢ Buddy's Math Challenge</div>
      <button class="close-btn" onclick="closeWindow('mathWindow')">&times;</button>
    </div>
    <div class="window-content">
      <p>Solve as many as you can! Streaks boost your score üéØ</p>

      <div id="mathHUD" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:10px 0;">
        <strong>Score:</strong> <span id="mathScore">0</span>
        <strong style="margin-left:8px;">Streak:</strong> <span id="mathStreak">0</span>
        <strong style="margin-left:8px;">Time:</strong> <span id="mathTime">60</span>s
        <div style="margin-left:auto;">
          <label style="font-weight:bold;">Difficulty:</label>
          <select id="mathDiff" onchange="resetMathGame()" style="padding:6px 8px;border-radius:6px;border:1px solid #ddd;">
            <option value="easy">Easy (+ ‚àí)</option>
            <option value="medium">Medium (+ ‚àí √ó)</option>
            <option value="hard">Hard (+ ‚àí √ó √∑)</option>
          </select>
        </div>
      </div>

      <div id="mathCard" style="background:#fafafa;border:2px solid #eee;border-radius:12px;padding:18px;text-align:center;">
        <div id="mathQuestion" style="font-size:28px;font-weight:bold;margin-bottom:14px;">3 + 4 = ?</div>
        <div id="mathChoices" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;"></div>
      </div>

      <div class="progress-bar"><div class="progress-fill" id="mathProgress"></div></div>
      <p style="margin-top:8px;"><small>Correct answers: <span id="mathCorrect">0</span></small></p>

      <div style="margin-top:12px;display:flex;gap:10px;justify-content:center;">
        <button class="app-button" onclick="startMathGame()" id="mathStartBtn">‚ñ∂Ô∏è Start</button>
        <button class="app-button" onclick="resetMathGame()">üîÑ Reset</button>
      </div>

      <div id="mathEnd" style="display:none;text-align:center;margin-top:14px;">
        <h3>Time!</h3>
        <p>Final Score: <strong id="mathFinalScore">0</strong></p>
        <button class="app-button" onclick="startMathGame()">Play Again</button>
      </div>
    </div>
  </div>

  <div class="achievement" id="achievement"></div>

  <!-- GLOBAL SCRIPT -->
  <script>
    // --- GLOBAL STATE ---
    let happiness = 70;
    let feedCount = 0;
    let isWindowBeingDragged = false;
    let windowCloseCount = 0;
    let petCount = 0;
    let earnedAchievements = new Set();

    // --- CORE DESKTOP FUNCTIONALITY ---
    document.addEventListener('mousedown', function(e) {
      if (e.target.classList.contains('window-header')) {
        isWindowBeingDragged = true;
        const windowEl = e.target.parentElement;
        const rect = windowEl.getBoundingClientRect();
        const offsetX = e.clientX - rect.left;
        const offsetY = e.clientY - rect.top;

        function moveWindow(ev) {
          if (isWindowBeingDragged) {
            windowEl.style.left = (ev.clientX - offsetX) + 'px';
            windowEl.style.top = (ev.clientY - offsetY) + 'px';
          }
        }
        function stopDragging() {
          isWindowBeingDragged = false;
          document.removeEventListener('mousemove', moveWindow);
          document.removeEventListener('mouseup', stopDragging);
        }
        document.addEventListener('mousemove', moveWindow);
        document.addEventListener('mouseup', stopDragging);
      }
    });

    function updateHappiness() {
      document.getElementById('happinessFill').style.width = happiness + '%';
    }
    function showAchievement(text) {
      const achievement = document.getElementById('achievement');
      achievement.textContent = 'üèÜ ' + text;
      achievement.classList.add('show');
      setTimeout(() => achievement.classList.remove('show'), 3000);
    }
    function openApp(appName) {
      const windows = {
        'food': 'foodWindow', 'typing': 'typingWindow', 'art': 'artWindow',
        'organize': 'organizeWindow', 'music': 'musicWindow', 'calculator': 'calculatorWindow',
        'photos': 'photosWindow', 'achievements': 'achievementsWindow', 'coloring': 'coloringWindow',
        'jumpgame': 'jumpgameWindow',
        'math': 'mathWindow'
      };
      const windowId = windows[appName];
      if (windowId) {
        document.getElementById(windowId).style.display = 'block';

        if (appName === 'art') initializeCanvas();
        else if (appName === 'achievements') displayAchievements();
        else if (appName === 'coloring') initializeColoring();
        else if (appName === 'jumpgame') initializeJumpGame();
        else if (appName === 'math') initializeMathGame();

        addAchievement('app-opener', 'üîß', 'App Explorer', 'Opened your first app!');
      }
    }
    function closeWindow(windowId) {
      document.getElementById(windowId).style.display = 'none';
      windowCloseCount++;
      if (windowId === 'jumpgameWindow' && jumpGameRunning) stopJumpGame();
      if (windowCloseCount >= 5) addAchievement('window-master', 'üñ•Ô∏è', 'Window Expert', 'Closed 5 windows!');
    }
    function showStartMenu() { showAchievement('You found the Start button!'); }

    // --- ACHIEVEMENT SYSTEM ---
    const allAchievements = [
      { id: 'app-opener', icon: 'üîß', name: 'App Explorer', description: 'Opened your first app!' },
      { id: 'feeder', icon: 'üçé', name: 'Buddy Feeder', description: 'Fed Buddy 5 times!' },
      { id: 'typer', icon: '‚å®Ô∏è', name: 'Typing Star', description: "Typed Buddy's name!" },
      { id: 'artist', icon: 'üé®', name: 'Creative Artist', description: 'Made 10 brush strokes!' },
      { id: 'organizer', icon: 'üìÅ', name: 'File Master', description: 'Organized all files!' },
      { id: 'coloring-master', icon: 'üñçÔ∏è', name: 'Coloring Expert', description: 'Colored 20 parts!' },
      { id: 'jump-champion', icon: 'üéÆ', name: 'Jump Champion', description: 'Collected 15 stars!' },
      { id: 'musician', icon: 'üéµ', name: 'Piano Player', description: 'Played 15 notes!' },
      { id: 'calculator', icon: 'üßÆ', name: 'Math Wizard', description: 'Completed 5 calculations!' },
      { id: 'photographer', icon: 'üì∑', name: 'Photo Explorer', description: 'Viewed all photos!' },
      { id: 'window-master', icon: 'üñ•Ô∏è', name: 'Window Expert', description: 'Closed 5 windows!' },
      { id: 'clicker', icon: 'üñ±Ô∏è', name: 'Mouse Master', description: 'Pet Buddy 10 times!' },
      { id: 'math-whiz', icon: 'üî¢', name: 'Math Whiz', description: 'Score 20+ in Math Challenge!' },
      { id: 'keyboard-ninja', icon: '‚å®Ô∏è', name: 'Keyboard Ninja', description: 'Used a keyboard shortcut!' }
    ];
    function addAchievement(id, icon, name, description) {
      if (!earnedAchievements.has(id)) {
        earnedAchievements.add(id);
        showAchievement(`${icon} ${name}`);
      }
    }
    function displayAchievements() {
      const grid = document.getElementById('achievementGrid');
      grid.innerHTML = '';
      allAchievements.forEach(ach => {
        const item = document.createElement('div');
        item.className = 'achievement-item';
        if (earnedAchievements.has(ach.id)) item.classList.add('earned');
        item.innerHTML = `<div class="achievement-icon">${ach.icon}</div><div class="achievement-name">${ach.name}</div><div class="achievement-description">${ach.description}</div>`;
        grid.appendChild(item);
      });
      document.getElementById('totalAchievements').textContent = earnedAchievements.size;
    }

    // --- PET & FEEDING ---
    function petBuddy() {
      happiness = Math.min(100, happiness + 3);
      petCount++;
      updateHappiness();
      const buddy = document.querySelector('.buddy-pet');
      buddy.style.animation = 'none';
      buddy.style.transform = 'rotate(15deg) scale(1.3)';
      setTimeout(() => {
        buddy.style.transform = 'rotate(0deg) scale(1)';
        buddy.style.animation = 'float 3s ease-in-out infinite';
      }, 300);
      if (petCount >= 10) addAchievement('clicker', 'üñ±Ô∏è', 'Mouse Master', 'Pet Buddy 10 times!');
    }
    function feedBuddy(food) {
      happiness = Math.min(100, happiness + 5);
      feedCount++;
      updateHappiness();
      document.getElementById('feedProgress').style.width = `${Math.min(100, (feedCount / 5) * 100)}%`;
      document.getElementById('feedCount').textContent = feedCount;
      if (feedCount >= 5) addAchievement('feeder', 'üçé', 'Buddy Feeder', 'Fed Buddy 5 times!');
    }

    // --- TYPING APP ---
    function checkTyping(value) {
      const target = 'BUDDY';
      const progress = Math.min(100, (value.length / target.length) * 100);
      document.getElementById('typingProgress').style.width = progress + '%';
      if (value.toUpperCase() === target) {
        happiness = Math.min(100, happiness + 10);
        updateHappiness();
        addAchievement('typer', '‚å®Ô∏è', 'Typing Star', "Typed Buddy's name perfectly!");
        document.getElementById('typingInput').value = '';
        setTimeout(() => document.getElementById('typingProgress').style.width = '0%', 1000);
      }
    }

    // --- ART STUDIO APP ---
    let canvas, ctx, isDrawing = false, currentColor = '#FF6B6B', strokeCount = 0;
    function initializeCanvas() {
      canvas = document.getElementById('drawingCanvas');
      ctx = canvas.getContext('2d');
      ctx.lineWidth = 4; ctx.lineCap = 'round'; ctx.strokeStyle = currentColor;
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);
    }
    function startDrawing(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      ctx.beginPath();
      ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
    }
    function draw(e) {
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
      ctx.stroke();
    }
    function stopDrawing() {
      if (isDrawing) {
        isDrawing = false;
        strokeCount++;
        document.getElementById('artProgress').style.width = `${Math.min(100, (strokeCount / 10) * 100)}%`;
        document.getElementById('strokeCount').textContent = strokeCount;
        if (strokeCount >= 10) addAchievement('artist', 'üé®', 'Creative Artist', 'Made 10 brush strokes!');
      }
    }
    function setDrawColor(color) {
      const colors = { 'red': '#FF6B6B', 'blue': '#4285F4', 'green': '#4CAF50', 'yellow': '#FFEB3B' };
      currentColor = colors[color]; if (ctx) ctx.strokeStyle = currentColor;
    }
    function clearCanvas() {
      if (ctx) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        strokeCount = 0; document.getElementById('artProgress').style.width = '0%'; document.getElementById('strokeCount').textContent = '0';
      }
    }

    // --- COLORING BOOK APP ---
    let currentColoringColor = '#FF6B6B', coloredPartsCount = 0;
    function initializeColoring() {
      document.querySelectorAll('#coloringWindow .colorable').forEach(el => {
        el.addEventListener('click', function() {
          if (this.getAttribute('fill') !== currentColoringColor) {
            this.setAttribute('fill', currentColoringColor);
            coloredPartsCount++;
            document.getElementById('coloringProgress').style.width = `${Math.min(100, (coloredPartsCount / 20) * 100)}%`;
            document.getElementById('coloredCount').textContent = coloredPartsCount;
            if (coloredPartsCount >= 20) addAchievement('coloring-master', 'üñçÔ∏è', 'Coloring Expert', 'Colored 20 parts!');
          }
        });
      });
      const firstColorBtn = document.querySelector('#coloringWindow .color-btn');
      if (firstColorBtn) firstColorBtn.classList.add('selected');
    }
    function setColoringColor(color, btnElement) {
      currentColoringColor = color;
      document.querySelectorAll('#coloringWindow .color-btn').forEach(btn => btn.classList.remove('selected'));
      btnElement.classList.add('selected');
    }

    // --- MUSIC MAKER APP ---
    let noteCount = 0, isRecording = false, recordedNotes = [], isPlaying = false;
    const noteFrequencies = { 'C': 261.63, 'C#': 277.18, 'D': 293.66, 'D#': 311.13, 'E': 329.63, 'F': 349.23, 'F#': 369.99, 'G': 392.00, 'G#': 415.30, 'A': 440.00, 'A#': 466.16, 'B': 493.88 };
    function playNote(note) {
      const key = document.querySelector(`[data-note="${note}"]`);
      if (key) { key.classList.add('active'); setTimeout(() => key.classList.remove('active'), 150); }
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(noteFrequencies[note], audioContext.currentTime);
        oscillator.connect(audioContext.destination);
        oscillator.start(); oscillator.stop(audioContext.currentTime + 0.2);
      } catch (e) { console.error("Web Audio API is not supported in this browser."); }
      noteCount++;
      document.getElementById('musicProgress').style.width = `${Math.min(100, (noteCount / 15) * 100)}%`;
      document.getElementById('noteCount').textContent = noteCount;
      if (isRecording) recordedNotes.push({ note, time: Date.now() });
      if (noteCount >= 15) addAchievement('musician', 'üéµ', 'Piano Player', 'Played 15 notes!');
    }
    function playPause() {
      const btn = document.getElementById('playBtn');
      isPlaying = !isPlaying;
      btn.textContent = isPlaying ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
      if (isPlaying) playRecordedSong();
    }
    function recordMode() {
      const btn = document.getElementById('recordBtn');
      isRecording = !isRecording;
      btn.textContent = isRecording ? '‚èπÔ∏è Stop' : '‚è∫Ô∏è Record';
      if (isRecording) recordedNotes = [];
    }
    function clearSong() {
      recordedNotes = []; isPlaying = false; isRecording = false;
      document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Play';
      document.getElementById('recordBtn').textContent = '‚è∫Ô∏è Record';
    }
    function playRecordedSong() {
      if (recordedNotes.length === 0) { isPlaying = false; return; }
      let startTime = recordedNotes[0].time;
      recordedNotes.forEach(noteData => {
        setTimeout(() => { if (isPlaying) playNote(noteData.note); }, noteData.time - startTime);
      });
      setTimeout(() => { isPlaying = false; document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Play'; }, recordedNotes[recordedNotes.length-1].time - startTime + 200);
    }

    // --- CALCULATOR APP ---
    let calcDisplay = '0', calcOperator = '', calcFirstNumber = '', calcWaitingForOperand = false, calcCount = 0;
    function updateCalcDisplay() { document.getElementById('calcDisplay').textContent = calcDisplay; }
    function clearCalc() { calcDisplay = '0'; calcOperator = ''; calcFirstNumber = ''; calcWaitingForOperand = false; updateCalcDisplay(); }
    function calcInput(value) {
      if (['+', '-', '*', '/'].includes(value)) {
        if (calcFirstNumber === '' || calcWaitingForOperand) { calcFirstNumber = calcDisplay;
        } else if (calcOperator) { calculateResult(); calcFirstNumber = calcDisplay; }
        calcOperator = value; calcWaitingForOperand = true;
      } else if (value === '.') {
        if (!calcDisplay.includes('.')) calcDisplay += '.';
      } else {
        if (calcWaitingForOperand || calcDisplay === '0') { calcDisplay = value; calcWaitingForOperand = false;
        } else { calcDisplay += value; }
      }
      updateCalcDisplay();
    }
    function calculateResult() {
      if (!calcOperator || calcFirstNumber === '' || calcWaitingForOperand) return;
      const first = parseFloat(calcFirstNumber);
      const second = parseFloat(calcDisplay);
      let result;
      switch (calcOperator) {
        case '+': result = first + second; break;
        case '-': result = first - second; break;
        case '*': result = first * second; break;
        case '/': result = second !== 0 ? first / second : 'Error'; break;
        default: return;
      }
      calcDisplay = String(result); calcFirstNumber = ''; calcOperator = ''; updateCalcDisplay();
      calcCount++; document.getElementById('calcProgress').style.width = `${Math.min(100, (calcCount / 5) * 100)}%`;
      document.getElementById('calcCount').textContent = calcCount;
      if (calcCount >= 5) addAchievement('calculator', 'üßÆ', 'Math Wizard', 'Completed 5 calculations!');
    }

    // --- PHOTO VIEWER APP ---
    let currentPhoto = 0, photoZoom = 1; let photosViewed = new Set([0]);
    function updatePhotoDisplay() {
      const photos = document.querySelectorAll('.photo');
      photos.forEach((photo, index) => {
        photo.classList.remove('active', 'prev');
        if (index === currentPhoto) photo.classList.add('active');
        else if (index < currentPhoto) photo.classList.add('prev');
      });
      document.getElementById('photoCounter').textContent = `${currentPhoto + 1} / ${photos.length}`;
      document.getElementById('photoViewCount').textContent = photosViewed.size;
      document.getElementById('photoProgress').style.width = `${(photosViewed.size / photos.length) * 100}%`;
      if (photosViewed.size >= photos.length) addAchievement('photographer', 'üì∑', 'Photo Explorer', 'Viewed all photos!');
    }
    function nextPhoto() { currentPhoto = (currentPhoto + 1) % document.querySelectorAll('.photo').length; photosViewed.add(currentPhoto); updatePhotoDisplay(); }
    function previousPhoto() { currentPhoto = (currentPhoto - 1 + document.querySelectorAll('.photo').length) % document.querySelectorAll('.photo').length; photosViewed.add(currentPhoto); updatePhotoDisplay(); }
    function zoomIn() { photoZoom = Math.min(3, photoZoom * 1.2); document.getElementById('photoDisplay').style.transform = `scale(${photoZoom})`; }
    function zoomOut() { photoZoom = Math.max(0.5, photoZoom / 1.2); document.getElementById('photoDisplay').style.transform = `scale(${photoZoom})`; }
    function resetZoom() { photoZoom = 1; document.getElementById('photoDisplay').style.transform = `scale(1)`; }

    // --- FILE ORGANIZATION APP ---
    let organizedCount = 0; let draggedElement = null;
    function allowDrop(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
    function dragFile(e) {
      draggedElement = e.currentTarget;
      e.currentTarget.classList.add('dragging');
      e.dataTransfer.setData('text/plain', e.currentTarget.getAttribute('data-type'));
    }
    function dropFile(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('drag-over');
      const fileType = e.dataTransfer.getData('text/plain');
      const folderType = e.currentTarget.getAttribute('data-type');
      if (fileType === folderType && draggedElement) {
        draggedElement.parentNode.removeChild(draggedElement);
        organizedCount++;
        document.getElementById('organizeProgress').style.width = `${(organizedCount / 5) * 100}%`;
        document.getElementById('organizedCount').textContent = organizedCount;
        if (organizedCount >= 5) addAchievement('organizer', 'üìÅ', 'File Master', 'Organized all files!');
      }
      draggedElement = null;
    }
    document.addEventListener('dragleave', (e) => { if(e.target.classList.contains('folder')) e.target.classList.remove('drag-over') });
    document.addEventListener('dragend', () => { if(draggedElement) draggedElement.classList.remove('dragging'); });

    // --- JUMP GAME APP ---
    let jumpGameRunning = false, jumpScore = 0, starsCollected = 0;
    let currentCharacter = 'princess';
    let jumpGameInterval, spawnInterval;
    let characterY = 30, velocityY = 0;
    const gravity = 1, jumpPower = 13;
    function initializeJumpGame() {
      const gameContainer = document.getElementById('jumpGameContainer');
      gameContainer.addEventListener('mousedown', makeJump);
      gameContainer.addEventListener('touchstart', (e) => { e.preventDefault(); makeJump(); });
      switchCharacter('princess');
    }
    function switchCharacter(char) {
      currentCharacter = char;
      document.getElementById('jumpCharacter').textContent = (char === 'princess') ? 'üë∏' : 'üë®‚ÄçüöÄ';
      document.getElementById('princessBtn').style.background = (char === 'princess') ? 'linear-gradient(to bottom, #FF69B4, #FF1493)' : '';
      document.getElementById('astronautBtn').style.background = (char === 'astronaut') ? 'linear-gradient(to bottom, #6C5CE7, #5A4FCF)' : '';
    }
    function startJumpGame() {
      if (jumpGameRunning) return;
      jumpGameRunning = true; jumpScore = 0; starsCollected = 0; characterY = 30; velocityY = 0;
      updateJumpGameUI();
      document.getElementById('jumpInstructions').classList.add('hidden');
      document.getElementById('startBtn').textContent = '‚èπÔ∏è Stop';
      jumpGameInterval = setInterval(updateJumpGame, 20);
      spawnInterval = setInterval(spawnGameItems, 2000);
    }
    function stopJumpGame() {
      jumpGameRunning = false;
      clearInterval(jumpGameInterval); clearInterval(spawnInterval);
      document.querySelectorAll('.jump-obstacle, .jump-star').forEach(el => el.remove());
      document.getElementById('jumpInstructions').classList.remove('hidden');
      document.getElementById('startBtn').textContent = '‚ñ∂Ô∏è Start Game';
    }
    function makeJump() { if (!jumpGameRunning) return; velocityY = jumpPower; }
    function spawnGameItems() {
      if (!jumpGameRunning) return;
      const container = document.getElementById('jumpGameContainer');
      const item = document.createElement('div');
      if (Math.random() > 0.4) { item.className = 'jump-obstacle'; item.textContent = currentCharacter === 'princess' ? 'üåµ' : 'üõ∏';
      } else { item.className = 'jump-star'; item.textContent = '‚≠ê'; }
      container.appendChild(item);
      setTimeout(() => item.remove(), 4000);
    }
    function updateJumpGame() {
      if (!jumpGameRunning) return;
      const character = document.getElementById('jumpCharacter');
      velocityY -= gravity; characterY += velocityY;
      if (characterY <= 30) { characterY = 30; velocityY = 0; }
      character.style.bottom = characterY + 'px';
      const charRect = character.getBoundingClientRect();
      document.querySelectorAll('.jump-obstacle').forEach(obs => { if (isColliding(charRect, obs.getBoundingClientRect())) showGameOver("You hit an obstacle!"); });
      document.querySelectorAll('.jump-star').forEach(star => {
        if (isColliding(charRect, star.getBoundingClientRect())) {
          star.remove(); starsCollected++; jumpScore += 10; updateJumpGameUI();
          if (starsCollected >= 15) { addAchievement('jump-champion', 'üéÆ', 'Jump Champion', 'Collected 15 stars!'); showGameOver("You Win! üéâ"); }
        }
      });
    }
    function isColliding(r1, r2) { return r1.right > r2.left && r1.left < r2.right && r1.bottom > r2.top && r1.top < r2.bottom; }
    function showGameOver(message) {
      stopJumpGame();
      const container = document.getElementById('jumpGameContainer');
      const gameOverDiv = document.createElement('div');
      gameOverDiv.className = 'game-over';
      gameOverDiv.innerHTML = `<h3>${message}</h3><p>Score: ${jumpScore}</p><button class="app-button" onclick="this.parentElement.remove(); startJumpGame();">Play Again</button>`;
      container.appendChild(gameOverDiv);
    }
    function updateJumpGameUI(){
      happiness = Math.min(100, happiness + starsCollected * 0.5); updateHappiness();
      document.getElementById('jumpScore').textContent = jumpScore;
      document.getElementById('starCount').textContent = `${starsCollected}/15`;
      document.getElementById('jumpProgress').style.width = `${(starsCollected/15)*100}%`;
    }

    /************  MATH GAME  ************/
    let mathTimer = null;
    let mathTimeLeft = 60;
    let mathScore = 0;
    let mathStreak = 0;
    let mathCorrect = 0;
    let currentAnswer = null;

    function initializeMathGame() {
      resetMathGame();
      renderMathQuestion();
    }

    function startMathGame() {
      clearInterval(mathTimer);
      mathTimeLeft = 60;
      mathScore = 0; mathStreak = 0; mathCorrect = 0;
      updateMathHUD();
      document.getElementById('mathEnd').style.display = 'none';
      document.getElementById('mathStartBtn').textContent = '‚è∏Ô∏è Pause';

      mathTimer = setInterval(() => {
        mathTimeLeft--;
        document.getElementById('mathTime').textContent = mathTimeLeft;
        if (mathTimeLeft <= 0) endMathGame();
      }, 1000);

      renderMathQuestion();
    }

    function endMathGame() {
      clearInterval(mathTimer);
      mathTimer = null;
      document.getElementById('mathFinalScore').textContent = mathScore;
      document.getElementById('mathEnd').style.display = 'block';
      document.getElementById('mathStartBtn').textContent = '‚ñ∂Ô∏è Start';
      happiness = Math.min(100, happiness + Math.min(20, Math.floor(mathScore/2)));
      updateHappiness();
      if (mathScore >= 20) addAchievement('math-whiz', 'üî¢', 'Math Whiz', 'Score 20+ in Math Challenge!');
    }

    function resetMathGame() {
      clearInterval(mathTimer);
      mathTimer = null;
      mathTimeLeft = 60;
      mathScore = 0; mathStreak = 0; mathCorrect = 0;
      document.getElementById('mathTime').textContent = mathTimeLeft;
      updateMathHUD();
      document.getElementById('mathEnd').style.display = 'none';
      document.getElementById('mathStartBtn').textContent = '‚ñ∂Ô∏è Start';
      renderMathQuestion();
    }

    function updateMathHUD() {
      document.getElementById('mathScore').textContent = mathScore;
      document.getElementById('mathStreak').textContent = mathStreak;
      document.getElementById('mathCorrect').textContent = mathCorrect;
      document.getElementById('mathProgress').style.width =
        `${Math.min(100, (mathCorrect / 20) * 100)}%`;
    }

    function renderMathQuestion() {
      const diff = document.getElementById('mathDiff').value;
      const { q, ans, choices } = makeProblem(diff);
      currentAnswer = ans;

      document.getElementById('mathQuestion').textContent = q;
      const wrap = document.getElementById('mathChoices');
      wrap.innerHTML = '';
      choices.forEach(v => {
        const btn = document.createElement('button');
        btn.className = 'app-button';
        btn.textContent = v;
        btn.onclick = () => handleMathChoice(v);
        wrap.appendChild(btn);
      });
    }

    function handleMathChoice(value) {
      const card = document.getElementById('mathCard');
      if (value === currentAnswer) {
        mathCorrect++;
        mathStreak++;
        mathScore += 1 + Math.min(5, Math.floor(mathStreak / 3)); // lil streak bonus
        card.style.boxShadow = '0 0 0 3px #4CAF50 inset';
        setTimeout(() => card.style.boxShadow = 'none', 250);
      } else {
        mathStreak = 0;
        card.style.boxShadow = '0 0 0 3px #FF6B6B inset';
        setTimeout(() => card.style.boxShadow = 'none', 250);
      }
      updateMathHUD();
      renderMathQuestion();
    }

    function makeProblem(diff) {
      // operators per difficulty
      const ops = diff === 'easy' ? ['+','-']
                 : diff === 'medium' ? ['+','-','*']
                 : ['+','-','*','/'];
      const op = ops[Math.floor(Math.random()*ops.length)];
      let a = rand(1, 20), b = rand(1, 20);
      let ans;

      if (op === '+') ans = a + b;
      else if (op === '-') { if (a < b) [a,b] = [b,a]; ans = a - b; }
      else if (op === '*') { a = rand(2,12); b = rand(2,12); ans = a * b; }
      else { // division - ensure whole number
        ans = rand(2,12);
        b = rand(2,12);
        a = ans * b;
      }

      const q = `${a} ${op} ${b} = ?`;
      const choices = new Set([ans]);
      while (choices.size < 4) {
        const noise = ans + rand(-10, 10);
        if (noise >= -50 && noise <= 400) choices.add(noise);
      }
      // shuffle
      const shuffled = Array.from(choices).sort(() => Math.random()-0.5);
      return { q, ans, choices: shuffled };
    }
    function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    // --- GLOBAL KEYBOARD LISTENER ---
    document.addEventListener('keydown', function(e) {
      if (e.code === 'Space') {
        if (document.getElementById('jumpgameWindow').style.display === 'block') {
          e.preventDefault();
          makeJump();
        }
      }
    });

    // --- APP INITIALIZATION ---
    updateHappiness();
    setTimeout(() => showAchievement("Welcome! Click an app to start!"), 1000);
  </script>
</body>
</html>
